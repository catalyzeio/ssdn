#!/usr/bin/env python
import argparse
import json
import sys

parser = argparse.ArgumentParser(description='Migrates an agent state file to account for new job states')
parser.add_argument('input', help='input agent.json file')
parser.add_argument('output', help='output file')
args = parser.parse_args()

infile, outfile = args.input, args.output

state = {}
if infile == '-':
    state = json.load(sys.stdin)
else:
    with open(infile) as data:
        state = json.load(data)

for job_id, job_data in state.items():
    s = job_data['state']
    if s == 10:
        s = 11
    elif s == 11:
        s = 13
    elif s == 12:
        s = 14
    elif s == 13:
        s = 10
    job_data['state'] = s

if outfile == '-':
    json.dump(state, sys.stdout)
else:
    with open(outfile, 'w') as dest:
        json.dump(state, dest)
